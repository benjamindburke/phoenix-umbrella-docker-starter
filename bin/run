#!/usr/bin/env bash

IMAGE_NAME="$1"
if [[ -z "$IMAGE_NAME" ]]; then
  >&2 echo "Please supply a container image name."
  exit 1
fi

# I would really love to execute this command for you, but when I try to,
# Docker interprets the host

CMD=$(cat << EOM
docker start \$(
    docker create \
        --network=bridge \
        --add-host host.docker.internal:host-gateway \
        -p 4000:443 \
        -p 5432:5432 \
        --env SECRET_KEY_BASE=\$( mix phx.gen.secret ) \
        --env DATABASE_URL='ecto://postgres:postgres@host.docker.internal:5432/hello_dev' \
        --env POOL_SIZE="10" \
        --env PHX_HOST="example.com" \
        $IMAGE_NAME:latest
)
EOM
)

echo "Execute the following command to create your new container:"
echo $CMD
echo && echo "Remember to edit the env variables with your own details!"